language: node_js
node_js:
  - 10
services:
  - docker
env:
  global:
    - PACT_BROKER_BASE_URL=https://lmayo.pactflow.io
    - PACT_BROKER_PUBLISH_VERIFICATION_RESULTS=true
    # Encrypted PACT_BROKER_TOKEN
    - secure: "IF6aYQA2Fr1R6VpkPFBC7y8qZJNhJxjXxbrVqA8V00IU1BuKJ5/Z5lzPulYZVz+jWxFmmc5pKCXiJ0xgcknRoxCubiDH7o5y4Zi2PTHokuwXG6CGOJrOrUlBF7tXlIwYahzeohrRCNeDhKghkYmPgnQcGK9/P8F0OH0QliS8A+wOR38WKXr8SoMNN8eEN/L2NWayf8i63dFxzcG2dGagu8o4XmBix8lsAvk2kJ1ROzHL5ptg+9uYjuFGG/CUaPZRBCjImmS3yCnii7AumdOw15kEBXjo7SzF3UETxkyjyNGf+pmUFZKE8iFCWAimuoeRwWHgQFeh13pjpfbBqqweeLVx3z8ik/idqxN+KcB8eN3h0yO4f67cLU8iGrQjNAd5QXWBC/DKzq58j4iHUcVPegIBbcvQX+sbSIk7vSZ4ITC8I0BUEM9smE3GjmoU1/1rlMuGa0GsBrs9l3qDbOxvPdIRoE5F/z7/NNTIG5NC3SPU+hiIxxiyC/bMYEdApTGyxxKm261lVwuI2zunWEMSfdU8X0VZAk47Yony69PB0Abkqt4k8X0C4XVFYrU9emb7cUhYvxj9WxlJkqxweP4Bmy/4vx79oUjfoE9kezdEwjL8cX1BUQsmBa9uyzQGc3TXbZWVigbVhBsXeqYYiRtiOPnYyxB9ONsgZtMS/cPjDgQ="
before_script:
  - docker pull pactfoundation/pact-cli:latest
script:
  # When a webhook triggers a build, the PACT_URL will be set. In this case, just run the verification step.
  # Otherwise, run the normal build.
  # This is just to get around the fact that Travis CI only has one build definition per repository.
  # Normally you would define a separate job for the webhook triggered verification.
  - >
    if [ -n "${PACT_URL}" ]; then
      make ci_webhook
    else
      make ci
    fi
